<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cusco Reporta – Registro de Usuario</title>
  
  <!-- Estilos -->
  <link rel="stylesheet" href="../css/style.css" />
  
  <!-- 1. Incluir Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
  <style>
    /* Tus estilos aquí */
  </style>
</head>
<body>
  <!-- Tu HTML aquí -->

  <!-- 2. Incluir tu configuración de Supabase -->
  <script src="../js/supabase.js"></script>
  
  <!-- 3. Código específico para registro -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('formRegistro');
      
      if (form) {
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          // Obtener datos del formulario
          const nombre = document.getElementById('nombre').value.trim();
          const apellido = document.getElementById('apellido').value.trim();
          const dni = document.getElementById('dni').value.trim();
          const correo = document.getElementById('correo').value.trim();
          const telefono = document.getElementById('telefono').value.trim();
          const password = document.getElementById('password').value;
          const confirmPassword = document.getElementById('confirmPassword').value;
          const direccion = document.getElementById('direccion').value.trim();
          
          // Validaciones
          if (password !== confirmPassword) {
            alert('Las contraseñas no coinciden');
            return;
          }
          
          if (password.length < 6) {
            alert('La contraseña debe tener al menos 6 caracteres');
            return;
          }
          
          try {
            // Usar el Supabase configurado en supabase.js
            const supabase = window.supabaseClient;
            
            if (!supabase) {
              alert('Error: Supabase no está configurado');
              return;
            }
            
            // Registrar usuario
            const { data, error } = await supabase.auth.signUp({
              email: correo,
              password: password,
              options: {
                data: {
                  nombre: nombre,
                  apellido: apellido,
                  dni: dni,
                  telefono: telefono,
                  direccion: direccion
                }
              }
            });
            
            if (error) throw error;
            
            alert('¡Registro exitoso! Por favor verifica tu email.');
            window.location.href = 'iniciar-sesion.html';
            
          } catch (error) {
            alert('Error al registrar: ' + error.message);
          }
        });
      }
    });
  </script>
</body>
</html>
